"use strict";var app=angular.module("minovateApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","firebase","ui.router","ui.bootstrap","ngTable","ui.utils","toastr","localytics.directives","ngFileUpload","slick","angles"]);app.constant("ROUTES",{app:{"abstract":!0,url:"/app",templateUrl:"views/app.html",authRequired:!0},"app.dashboard":{url:"/dashboard",controller:"DashboardCtrl",templateUrl:"views/pages/dashboard.html",authRequired:!0},"app.categories":{"abstract":!0,url:"/categories",template:"<div ui-view></div>",authRequired:!0},"app.categories.list":{url:"/list",controller:"CategoriesCtrl",templateUrl:"views/pages/categories/list.html",authRequired:!0},"app.categories.new":{url:"/new",controller:"CategoriesCtrl",templateUrl:"views/pages/categories/new.html",authRequired:!0},"app.categories.edit":{url:"/edit/:id",controller:"CategoriesCtrl",templateUrl:"views/pages/categories/edit.html",authRequired:!0},"app.categories.show":{url:"/show/:id",controller:"CategoriesCtrl",templateUrl:"views/pages/categories/show.html",authRequired:!0},"app.products":{"abstract":!0,url:"/products",template:"<div ui-view></div>",authRequired:!0},"app.products.list":{url:"/list",controller:"ProductsCtrl",templateUrl:"views/pages/products/list.html",authRequired:!0},"app.products.new":{url:"/new",controller:"ProductsCtrl",templateUrl:"views/pages/products/new.html",authRequired:!0},"app.products.edit":{url:"/edit/:id",controller:"ProductsCtrl",templateUrl:"views/pages/products/edit.html",authRequired:!0},"app.products.show":{url:"/show/:id",controller:"ProductsCtrl",templateUrl:"views/pages/products/show.html",authRequired:!0},"app.orders":{"abstract":!0,url:"/orders",template:"<div ui-view></div>",authRequired:!0},"app.orders.list":{url:"/list",controller:"OrdersCtrl",templateUrl:"views/pages/orders/list.html",authRequired:!0},"app.orders.show":{url:"/show/:id",controller:"OrdersCtrl",templateUrl:"views/pages/orders/show.html",authRequired:!0},"app.users":{"abstract":!0,url:"/users",template:"<div ui-view></div>",authRequired:!0},"app.users.list":{url:"/list",controller:"UsersCtrl",templateUrl:"views/pages/users/list.html",authRequired:!0},"app.users.new":{url:"/new",controller:"UsersCtrl",templateUrl:"views/pages/users/new.html",authRequired:!0},"app.users.edit":{url:"/edit/:id",controller:"UsersCtrl",templateUrl:"views/pages/users/edit.html",authRequired:!0},"app.users.show":{url:"/show/:id",controller:"UsersCtrl",templateUrl:"views/pages/users/show.html",authRequired:!0},"app.profile":{url:"/profile",controller:"ProfileCtrl",templateUrl:"views/pages/profile.html",authRequired:!0},"app.settings":{url:"/settings",controller:"SettingsCtrl",templateUrl:"views/pages/settings.html",authRequired:!0},core:{"abstract":!0,url:"/core",template:"<div ui-view></div>",containerClass:"core"},"core.login":{url:"/login",controller:"AuthCtrl",templateUrl:"views/pages/login.html",containerClass:"core"},"core.forgotpass":{url:"/forgotpass",controller:"ForgotPasswordCtrl",templateUrl:"views/pages/forgotpass.html"}}),app.constant("loginRedirectPath","core.login").controller("MainCtrl",["$scope","Auth","$state","loginRedirectPath","$firebaseObject","$window",function($scope,Auth,$state,loginRedirectPath,$firebaseObject,$window){$scope.main={title:"Minovate CRUD App",appName:"minovateApp",settings:{navbarHeaderColor:"scheme-default",sidebarColor:"scheme-default",brandingColor:"scheme-default",activeColor:"default-scheme-color",headerFixed:!0,asideFixed:!0,rightbarShow:!1}},$scope.settings=$firebaseObject(firebase.database().ref().child("settings")),Auth.$onAuthStateChanged(function(user){if(user){var ref=firebase.database().ref();$scope.profile=$firebaseObject(ref.child("users").child(user.uid)),$scope.logout=function(){angular.forEach($window.openFirebaseConnections,function(item){item.$destroy()}),$scope.profile.$destroy(),Auth.$signOut(),$state.go(loginRedirectPath,{},{reload:!0})}}})}]).config(["$provide",function($provide){function firebaseDecorator($delegate){return function(ref){var list=$delegate(ref);return window.openFirebaseConnections.push(list),list}}firebaseDecorator.$inject=["$delegate"],$provide.decorator("$firebaseArray",firebaseDecorator),$provide.decorator("$firebaseObject",firebaseDecorator),firebaseDecorator.$inject=["$delegate"]}]);var securedRoutes=[];app.config(["$stateProvider",function($stateProvider){$stateProvider.whenAuthenticated=function(path,route){securedRoutes.push(path),route.resolve=route.resolve||{},route.resolve.user=["Auth",function(Auth){return Auth.$requireSignIn()}],route.resolve.currentUser=["Auth","user","$q",function(Auth,user,$q){var deferred=$q.defer(),ref=firebase.database().ref();return ref.child("users").child(user.uid).on("value",function(snapshot){deferred.resolve(snapshot.val())}),deferred.promise}],$stateProvider.state(path,route)}}]).config(["$stateProvider","$urlRouterProvider","ROUTES",function($stateProvider,$urlRouterProvider,ROUTES){angular.forEach(ROUTES,function(route,path){route.authRequired?$stateProvider.whenAuthenticated(path,route):$stateProvider.state(path,route)}),$urlRouterProvider.otherwise("/app/dashboard")}]).run(["$rootScope","$state","$location","ROUTES","loginRedirectPath","$stateParams","Auth",function($rootScope,$state,$location,ROUTES,loginRedirectPath,$stateParams,Auth){$rootScope.$state=$state,$rootScope.$stateParams=$stateParams,$rootScope.$on("$stateChangeSuccess",function(event,toState){Auth.$onAuthStateChanged(function(firebaseUser){$rootScope.loggedIn=!!firebaseUser,$state.current.authRequired&&!firebaseUser&&$state.go(loginRedirectPath)}),event.targetScope.$watch("$viewContentLoaded",function(){angular.element("html, body, #content").animate({scrollTop:0},200),setTimeout(function(){angular.element("#wrap").css("visibility","visible"),angular.element(".dropdown").hasClass("open")||angular.element(".dropdown").find(">ul").slideUp()},200)}),$rootScope.containerClass=toState.containerClass}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){"AUTH_REQUIRED"===error&&$state.go(loginRedirectPath)})}]),app.controller("NavCtrl",["$scope",function($scope){$scope.oneAtATime=!1,$scope.status={isFirstOpen:!0,isSecondOpen:!0,isThirdOpen:!0}}]),app.controller("DashboardCtrl",["$scope","$state","$stateParams","$firebaseArray","$firebaseObject","$filter","uploadImage","user","toastr",function($scope,$state,$stateParams,$firebaseArray,$firebaseObject,$filter,uploadImage,user,toastr){toastr.success("All crud operations are disabled for demo purposes on firebase db level, but will be functional on your own firebase database","CRUD Operations Disabled!",{progressBar:!0,timeOut:"30000"}),toastr.warning('Set-up s3upload.js service to use proper data for uploading, for help read <a href="http://beckcd.com/nashville/software/school/2014/11/29/file-uploading-with-angular/" target="_blank">this article</a>',"Amazon S3 Upload!",{progressBar:!0,timeOut:"30000",allowHtml:!0}),$scope.page={title:"Dashboard"};var ref=firebase.database().ref();$scope.products=$firebaseArray(ref.child("products")),$scope.orders=$firebaseArray(ref.child("orders")),$scope.users=$firebaseArray(ref.child("users")),$scope.categories=$firebaseArray(ref.child("categories")),$scope.categoriesObject=$firebaseObject(ref.child("categories")),$scope.users.$loaded(function(){$scope.activeUsers=$filter("filter")($scope.users,{blocked:!1})}),$scope.ordersValue=0,$scope.orders.$loaded(function(){angular.forEach($scope.orders,function(val,key){$scope.ordersValue+=val.subTotal})})}]).controller("OrdersChartCtrl",["$scope","$filter","$http",function($scope,$filter,$http){function fetchOrders(){$scope.orders.$ref().orderByChild("created_at").limitToLast(1).once("value",function(snapshot){snapshot.forEach(function(data){var x,lastOrder=data.val(),lastDate=moment(lastOrder.created_at).startOf("day").format("x"),dayDuration=864e5;$scope.chart={labels:[],datasets:[{fillColor:"#45ccce",strokeColor:"rgba(0,0,0,0)",data:[]}]},$scope.options.tooltipTemplate="<%if (label){%><%=label%>: <%}%> $<%= value %>","7d"===$scope.range?(x=7,lastDate-=6*dayDuration):"31d"===$scope.range&&(x=31,lastDate-=30*dayDuration);for(var i=0;x>i;i++)$scope.chart.labels.push($filter("date")(lastDate,"dd MMM")),lastDate+=dayDuration;$scope.orders.$loaded(function(){angular.forEach($scope.chart.labels,function(date){var dayValue=0;angular.forEach($scope.orders,function(order){var orderDate=$filter("date")(order.created_at,"dd MMM");orderDate===date&&(dayValue+=order.subTotal)}),$scope.chart.datasets[0].data.push(dayValue)})})})})}$scope.range="7d",$scope.options={scaleShowVerticalLines:!1,barValueSpacing:20},fetchOrders(),$scope.$watch("range",function(newVal,oldVal){newVal!==oldVal&&("7d"===newVal&&($scope.options.barValueSpacing=20),"31d"===newVal&&($scope.options.barValueSpacing=5),fetchOrders())})}]).controller("ProductsChartCtrl",["$scope","$filter","$http",function($scope,$filter,$http){$scope.chart=[{value:0,color:"#F7464A",highlight:"#FF5A5E",label:""},{value:0,color:"#46BFBD",highlight:"#5AD3D1",label:""},{value:0,color:"#FDB45C",highlight:"#FFC870",label:""}],$scope.categories.$loaded(function(){$scope.products.$loaded(function(){var parentCategories=$filter("filter")($scope.categories,{parent:!0}),childCategories=$filter("filter")($scope.categories,{parent:!1});angular.forEach(parentCategories,function(val,key){var quantity=0;angular.forEach(childCategories,function(category){var x=0;angular.forEach($scope.products,function(product){product.categoryId===category.$id&&x++}),category.parentId===val.$id&&x>0&&quantity++}),$scope.chart[key].label=val.name,$scope.chart[key].value=quantity})})})}]),app.controller("AuthCtrl",["$scope","Auth","$state","$firebaseArray","toastr",function($scope,Auth,$state,$firebaseArray,toastr){function assertValidAccountProps(){return $scope.email?$scope.pass&&$scope.confirm?$scope.createMode&&$scope.pass!==$scope.confirm&&($scope.err="Passwords do not match"):$scope.err="Please enter a password":$scope.err="Please enter an email address",!$scope.err}function errMessage(err){return angular.isObject(err)&&err.code?err.code:err+""}toastr.success("demo@minovate.com, pass: minovate","Login default data!",{progressBar:!0,timeOut:"15000"}),$scope.loggedIn&&$state.go("app.dashboard",{},{reload:!0}),$scope.email=null,$scope.pass=null,$scope.confirm=null,$scope.createMode=!1,$scope.login=function(email,pass){$scope.err=null,Auth.$signInWithEmailAndPassword(email,pass).then(function(authData){console.log("Authenticated successfully with payload:",authData),$state.go("app.dashboard",{},{reload:!0})},function(err){$scope.err=errMessage(err),console.log("Login Failed!",err)})},$scope.register=function(){if($scope.err=null,assertValidAccountProps()){var email=$scope.email,pass=$scope.pass;Auth.$createUserWithEmailAndPassword(email,pass).then(function(){return Auth.$signInWithEmailAndPassword(email,pass)}).then(function(user){var ref=firebase.database().ref();ref.child("users").child(user.uid).set({email:email,role:"user"})}).then(function(){$state.go("app.dashboard",{},{reload:!0})},function(err){$scope.err=errMessage(err)})}}}]),app.controller("CategoriesCtrl",["$scope","$state","$stateParams","$firebaseArray","$firebaseObject",function($scope,$state,$stateParams,$firebaseArray,$firebaseObject){var ref=firebase.database().ref();if($scope.categories=$firebaseArray(ref.child("categories")),$scope.categoriesObject=$firebaseObject(ref.child("categories")),$stateParams.id){var id=$stateParams.id;$scope.category=$firebaseObject(ref.child("categories").child(id))}else $scope.category={}}]).controller("CategoriesListCtrl",["$scope","$filter","ngTableParams","toastr",function($scope,$filter,ngTableParams,toastr){$scope["delete"]=function(category){confirm("Are you sure?")&&$scope.categories.$remove(category).then(function(){console.log("category deleted"),toastr.success("Category Removed!","Category has been removed")})},$scope.categories.$loaded().then(function(){angular.forEach($scope.categories,function(value,key){value.parentId&&$scope.categoriesObject[value.parentId]&&(value.parentName=$scope.categoriesObject[value.parentId].name)}),$scope.$watchCollection("categories",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.$watch("searchText",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.categories.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.categories,params.orderBy()):$scope.categories;orderedData=$filter("filter")(orderedData,$scope.searchText),params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}]).controller("NewCategoryCtrl",["$scope","toastr","$state","$filter",function($scope,toastr,$state,$filter){var ref=firebase.database().ref();$scope.ok=function(){$scope.category.parentId?$scope.category.parent=!1:$scope.category.parent=!0,$scope.categories.$add($scope.category).then(function(categoryRef){ref.child("categories").child(categoryRef.key).update({created_at:firebase.database.ServerValue.TIMESTAMP}),toastr.success("Category Added!","Category has been created"),$state.go("app.categories.list",{},{reload:!0})})}}]).controller("EditCategoryCtrl",["$scope","$firebaseObject","toastr","$state","$filter",function($scope,$firebaseObject,toastr,$state,$filter){var ref=firebase.database().ref();$scope.categories.$loaded(function(){$scope.ok=function(){$scope.category.parentId?$scope.category.parent=!1:$scope.category.parent=!0,$scope.category.$save().then(function(categoryRef){ref.child("categories").child(categoryRef.key).update({updated_at:firebase.database.ServerValue.TIMESTAMP}),toastr.success("Category Saved!","Category has been saved"),$state.go("app.categories.list",{},{reload:!0})})}})}]).controller("ShowCategoryCtrl",["$scope","$firebaseObject","toastr","$state","FBURL","$stateParams",function($scope,$firebaseObject,toastr,$state,FBURL,$stateParams){}]),app.controller("ProductsCtrl",["$scope","$state","$stateParams","$firebaseArray","$firebaseObject","$filter","uploadImage","user",function($scope,$state,$stateParams,$firebaseArray,$firebaseObject,$filter,uploadImage,user){var ref=firebase.database().ref();if($scope.products=$firebaseArray(ref.child("products")),$scope.productsObject=$firebaseObject(ref.child("products")),$scope.categories=$firebaseArray(ref.child("categories")),$scope.categoriesObject=$firebaseObject(ref.child("categories")),$scope.user=user,$stateParams.id){var id=$stateParams.id;$scope.product=$firebaseObject(ref.child("products").child(id))}else $scope.product={};$scope.categories.$loaded().then(function(){$scope.childCategories=[],angular.forEach($scope.categories,function(value,key){value.parentId&&$scope.categoriesObject[value.parentId]?(value.parentName=$scope.categoriesObject[value.parentId].name,$scope.childCategories.push(value)):0===$filter("filter")($scope.categories,{parentId:value.$id}).length&&$scope.childCategories.push(value)})}),$scope.units={pc:"Piece",kg:"Kilogram",g:"Gram",m:"Meter",l:"Liter"},$scope.statuses={published:"published",notPublished:"not published",banned:"banned"},$scope.uploadImages=function(files,user,cb){files&&files.length&&uploadImage.uploadMultiple(files,user,cb)}}]).controller("ProductsListCtrl",["$scope","$filter","ngTableParams","toastr",function($scope,$filter,ngTableParams,toastr){$scope["delete"]=function(product){confirm("Are you sure?")&&$scope.products.$remove(product).then(function(){console.log("product deleted"),toastr.success("Product Removed!","Product has been removed")})},$scope.products.$loaded().then(function(){function extendArray(){angular.forEach($scope.products,function(value,key){value.categoryId&&$scope.categoriesObject[value.categoryId]&&(value.categoryName=$scope.categoriesObject[value.categoryId].name)})}extendArray(),$scope.$watchCollection("products",function(newVal,oldVal){newVal!==oldVal&&(extendArray(),$scope.tableParams.reload())}),$scope.$watch("searchText",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{id:"asc"}},{total:$scope.products.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.products,params.orderBy()):$scope.products;orderedData=$filter("filter")(orderedData,$scope.searchText),params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}]).controller("NewProductCtrl",["$scope","toastr","$state","$filter",function($scope,toastr,$state,$filter){var ref=firebase.database().ref();ref.child("productsCounter").once("value",function(snapshot){var data=snapshot.val();data?$scope.product.id=$filter("digits")(data+1,6):$scope.product.id="000001"}),$scope.ok=function(form){var x=0,cb=function(filelink){$scope.product.images[x]={},$scope.product.images[x].src=filelink,x++,$scope.product.images.length===x&&$scope.products.$add($scope.product).then(function(productRef){ref.child("productsCounter").transaction(function(currentValue){return(currentValue||0)+1},function(err,committed,ss){if(err)console.log(err);else if(committed){var id=$filter("digits")(ss.val(),6);ref.child("products").child(productRef.key).update({id:id,created_at:firebase.database.ServerValue.TIMESTAMP})}}),toastr.success("Product Added!","Product has been created"),$state.go("app.products.list",{},{reload:!0})})};form.images.$valid&&$scope.uploadImages($scope.product.images,$scope.user,cb)}}]).controller("EditProductCtrl",["$scope","$firebaseObject","toastr","$state","$filter",function($scope,$firebaseObject,toastr,$state,$filter){var ref=firebase.database().ref();$scope.editing=!0,$scope.products.$loaded(function(){$scope.ok=function(form){function save(){$scope.product.$save().then(function(productRef){ref.child("products").child(productRef.key).update({updated_at:firebase.database.ServerValue.TIMESTAMP}),toastr.success("Product Saved!","Product has been saved"),$state.go("app.products.list",{},{reload:!0})})}var x=0,cb=function(filelink){$scope.product.images[x]={},$scope.product.images[x].src=filelink,x++,$scope.product.images.length===x&&save()};form.images.$modelValue[0]&&form.images.$modelValue[0].$ngfDataUrl&&form.images.$valid?$scope.uploadImages($scope.product.images,$scope.user,cb):save()}})}]).controller("ShowProductCtrl",["$scope","$firebaseObject","toastr","$state","FBURL","$stateParams",function($scope,$firebaseObject,toastr,$state,FBURL,$stateParams){}]),app.controller("OrdersCtrl",["$scope","$state","$stateParams","$firebaseArray","$firebaseObject","$filter","user",function($scope,$state,$stateParams,$firebaseArray,$firebaseObject,$filter,user){var ref=firebase.database().ref();if($scope.orders=$firebaseArray(ref.child("orders")),$scope.ordersObject=$firebaseObject(ref.child("orders")),$scope.categories=$firebaseArray(ref.child("categories")),$scope.categoriesObject=$firebaseObject(ref.child("categories")),$scope.products=$firebaseArray(ref.child("products")),$scope.productsObject=$firebaseObject(ref.child("products")),$scope.user=user,$stateParams.id){var id=$stateParams.id;$scope.order=$firebaseObject(ref.child("orders").child(id))}else $scope.order={}}]).controller("OrdersListCtrl",["$scope","$filter","ngTableParams","toastr",function($scope,$filter,ngTableParams,toastr){$scope["delete"]=function(order){confirm("Are you sure?")&&$scope.orders.$remove(order).then(function(){console.log("order deleted"),toastr.success("Order Removed!","Order has been removed")})},$scope.changeStatus=function(order,status){order.status=status,$scope.orders.$save(order).then(function(){console.log("status changed")})},$scope.orders.$loaded().then(function(){$scope.$watchCollection("orders",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.$watch("searchText",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{id:"asc"}},{total:$scope.orders.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.orders,params.orderBy()):$scope.orders;orderedData=$filter("filter")(orderedData,$scope.searchText),params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}]).controller("ShowOrderCtrl",["$scope","$firebaseObject","toastr","$state","$stateParams",function($scope,$firebaseObject,toastr,$state,$stateParams){}]),app.controller("UsersCtrl",["$scope","$state","$stateParams","$firebaseArray","$firebaseObject","currentUser","Auth",function($scope,$state,$stateParams,$firebaseArray,$firebaseObject,currentUser,Auth){var ref=firebase.database().ref();if($scope.users=$firebaseArray(ref.child("users")),$scope.blockedUsers=ref.child("blockedUsers"),$stateParams.id){var id=$stateParams.id;$scope.user=$firebaseObject(ref.child("users").child(id))}else $scope.user={};"admin"===currentUser.role?$scope.roles={admin:"admin",superuser:"superuser",user:"user"}:$scope.roles={superuser:"superuser",user:"user"}}]).controller("UsersListCtrl",["$scope","$filter","ngTableParams","toastr","Auth",function($scope,$filter,ngTableParams,toastr,Auth){firebase.database().ref();$scope["delete"]=function(user){confirm("Are you sure?")&&($scope.users.$ref().child(user.$id).child("blocked").set(!0),$scope.blockedUsers.child(user.$id).set({blocked:!0}),$scope.tableParams.reload())},$scope.passReset=function(user){confirm("Are you sure?")&&Auth.$sendPasswordResetEmail(user.email).then(function(){toastr.success("We have sent an email with new password","Password reset!"),console.log("Password reset email sent successfully")},function(error){console.log("Error sending password reset email:",error)})},$scope.users.$loaded().then(function(){$scope.$watchCollection("users",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.$watch("searchText",function(newVal,oldVal){newVal!==oldVal&&$scope.tableParams.reload()}),$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{name:"asc"}},{total:$scope.users.length,getData:function($defer,params){var orderedData=params.sorting()?$filter("orderBy")($scope.users,params.orderBy()):$scope.users;orderedData=$filter("filter")(orderedData,{blocked:!1}),orderedData=$filter("filter")(orderedData,$scope.searchText),params.total(orderedData.length),$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}})})}]).controller("NewUserCtrl",["$scope","toastr","$state","$filter","Auth",function($scope,toastr,$state,$filter,Auth){var ref=firebase.database().ref(),profiles=ref.child("users");$scope.editing=!1,$scope.ok=function(){$scope.userEntry={name:$scope.user.name,email:$scope.user.email,role:$scope.user.role,address:{street:$scope.user.address.street,city:$scope.user.address.city,zip:$scope.user.address.zip,country:$scope.user.address.country},phone:$scope.user.phone,blocked:!1},secondaryApp.auth().createUserWithEmailAndPassword($scope.user.email,$scope.user.password).then(function(userData){profiles.child(userData.uid).set($scope.userEntry),secondaryApp.auth().signOut(),secondaryApp["delete"](),console.log("Successfully created user account with uid:",userData.uid),toastr.success("User has been created","User Added!"),$state.go("app.users.list",{},{reload:!0})},function(error){console.log("Error creating user:",error),toastr.error(error.message,"Adding User Error!")})}}]).controller("EditUserCtrl",["$scope","$firebaseObject","toastr","$state","$filter","Auth",function($scope,$firebaseObject,toastr,$state,$filter,Auth){$scope.editing=!0;var ref=firebase.database().ref(),profiles=ref.child("users");$scope.users.$loaded(function(){$scope.ok=function(){$scope.userEntry={name:$scope.user.name,email:$scope.user.email,role:$scope.user.role,address:{street:$scope.user.address.street,city:$scope.user.address.city,zip:$scope.user.address.zip,country:$scope.user.address.country},phone:$scope.user.phone};var updateOnSuccess=function(){profiles.child($scope.user.$id).update($scope.userEntry,function(){toastr.success("User has been saved","User Saved!"),$state.go("app.users.list",{},{reload:!0})})};updateOnSuccess()}})}]).controller("ShowUserCtrl",["$scope","$firebaseObject","toastr","$state","$stateParams",function($scope,$firebaseObject,toastr,$state,$stateParams){}]),app.controller("ProfileCtrl",["$scope","$firebaseObject","currentUser","user","toastr","uploadImage","Auth",function($scope,$firebaseObject,currentUser,user,toastr,uploadImage,Auth){var ref=firebase.database().ref(),profiles=ref.child("users");$scope.user=$firebaseObject(ref.child("users").child(user.uid)),$scope.user.$loaded().then(function(){$scope.uploadImage=function(file,user,cb){uploadImage.uploadToS3(file,user,cb)},$scope.oldEmail=angular.copy($scope.user.email)}),$scope.user.changeEmail=!1,$scope.user.changePass=!1,$scope.saveUser=function(form){$scope.userEntry={avatar:$scope.user.avatar,name:$scope.user.name,email:$scope.user.email,role:$scope.user.role,address:{street:$scope.user.address.street,city:$scope.user.address.city,zip:$scope.user.address.zip,country:$scope.user.address.country},phone:$scope.user.phone};var updateOnSuccess=function(){function save(){profiles.child($scope.user.$id).update($scope.userEntry),toastr.success("Your Personal Informations has been updated","Saving success!"),$scope.user.changeEmail=!1,$scope.user.changePass=!1}var cb=function(filelink){$scope.userEntry.avatar=filelink,save()};form.avatar.$modelValue&&form.avatar.$modelValue.$ngfDataUrl&&form.avatar.$valid?$scope.uploadImage($scope.userEntry.avatar,user,cb):save()},changeEmail=$scope.user.changeEmail,changePass=$scope.user.changePass;changeEmail===!0?Auth.$signInWithEmailAndPassword($scope.oldEmail,$scope.user.password).then(function(){Auth.$updateEmail($scope.user.email).then(function(){console.log("Email changed successfully"),toastr.success("Email has been changed successfully","Email changed!"),updateOnSuccess()},function(error){toastr.error(error.message,"Error changing email!"),console.log("Error changing email:",error)})}):changePass===!0?Auth.$signInWithEmailAndPassword($scope.user.email,$scope.user.oldpassword).then(function(){Auth.$updatePassword($scope.user.password).then(function(){console.log("Password changed successfully"),toastr.success("Password has been changed successfully","Password changed!"),updateOnSuccess()},function(error){toastr.error(error.message,"Error changing password!"),console.log("Error changing password:",error)})}):updateOnSuccess()}}]),app.controller("SettingsCtrl",["$scope","$state","$stateParams","currentUser","user","$filter",function($scope,$state,$stateParams,currentUser,user,$filter,toastr,toastrConfig){$scope.saveSettings=function(){$scope.settings.$save()}}]),app.controller("ForgotPasswordCtrl",["$scope","$firebase","Auth","$state","toastr",function($scope,$firebase,Auth,$state,toastr){$scope.email=null,$scope.ok=function(){Auth.$sendPasswordResetEmail($scope.email).then(function(){console.log("Password reset email sent successfully"),toastr.success("Your password has been reseted, check your email","Password reset!"),$state.go("core.login",{},{reload:!0})},function(error){console.log("Error sending password reset email:",error),toastr.error(error.code,"Reset Error!")})}}]),app.config(["$provide",function($provide){$provide.decorator("ngCloakDirective",["$delegate","Auth",function($delegate,Auth){var directive=$delegate[0],_compile=directive.compile;return directive.compile=function(element,attr){Auth.$waitForSignIn().then(function(){_compile.call(directive,element,attr)})},$delegate}])}]),app.factory("Auth",["$firebaseAuth",function($firebaseAuth){return $firebaseAuth()}]),app.filter("digits",[function(){return function(input,digits){return 2===digits&&10>input&&(input="0"+input),3===digits&&(10>input?input="00"+input:input>=10&&100>input&&(input="0"+input)),4===digits&&(10>input?input="000"+input:input>=10&&100>input?input="00"+input:input>=100&&1e3>input&&(input="0"+input)),5===digits&&(10>input?input="0000"+input:input>=10&&100>input?input="000"+input:input>=100&&1e3>input?input="00"+input:input>=1e3&&1e4>input&&(input="0"+input)),6===digits&&(10>input?input="00000"+input:input>=10&&100>input?input="0000"+input:input>=100&&1e3>input?input="000"+input:input>=1e3&&1e4>input?input="00"+input:input>=1e4&&1e5>input&&(input="0"+input)),input}}]),app.factory("uploadImage",["Upload",function(Upload){function uploadToS3(file,user,cb){var userID=user.uid.replace(/:/g,""),time=moment().format("x"),S3url="https://minovate.s3.amazonaws.com/",awsaccesskeyid="AKIAJBBPAYNMFYC6YMWQ",policy="eyJleHBpcmF0aW9uIjoiMjAyMC0wMS0wMVQwMDowMDowMFoiLCJjb25kaXRpb25zIjpbeyJidWNrZXQiOiJtaW5vdmF0ZSJ9LHsiYWNsIjogInB1YmxpYy1yZWFkIn0sWyJzdGFydHMtd2l0aCIsIiRDb250ZW50LVR5cGUiLCIiXSxbInN0YXJ0cy13aXRoIiwiJGtleSIsIiJdXX0=",signature="xpE4b93F9hQNCOwpKEno60jPwG8=";Upload.upload({url:S3url,method:"POST",data:{"Content-Type":""!==file.type?file.type:"application/octet-stream",key:userID+"/"+time+"_"+file.name,acl:"public-read",awsaccesskeyid:awsaccesskeyid,policy:policy,signature:signature,file:file}}).then(function(resp){console.log("Success "+resp.config.data.file.name+"uploaded. Response: "+resp.data);var filelink="https://s3.amazonaws.com/minovate/"+userID+"/"+time+"_"+resp.config.data.file.name;cb(filelink)},function(resp){console.log(resp),console.log("Error status: "+resp.status)},function(evt){var progressPercentage=Math.min(100,parseInt(100*evt.loaded/evt.total));file.progress=progressPercentage,console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name)})}function uploadMultiple(files,user,cb){var userID=user.uid.replace(/:/g,""),time=moment().format("x");angular.forEach(files,function(value,key){Upload.upload({url:S3url,method:"POST",data:{"Content-Type":""!==value.type?value.type:"application/octet-stream",key:userID+"/"+time+"_"+value.name,acl:"public-read",awsaccesskeyid:awsaccesskeyid,policy:policy,signature:signature,file:value}}).then(function(resp){console.log("Success "+resp.config.data.file.name+"uploaded. Response: "+resp.data);var filelink="https://s3.amazonaws.com/minovate/"+userID+"/"+time+"_"+resp.config.data.file.name;cb(filelink)},function(resp){console.log(resp),console.log("Error status: "+resp.status)},function(evt){var progressPercentage=Math.min(100,parseInt(100*evt.loaded/evt.total));value.progress=progressPercentage,console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name)})})}function setThumbnail(file,cb){_imageToBase64(file,function(base64){var fileName=file.name;cb(fileName,base64)})}function _imageToBase64(file,cb){if(file&&file.type.indexOf("image")>-1){var fr=new FileReader;fr.readAsDataURL(file),fr.onload=function(e){cb(e.target.result)}}}return{uploadToS3:uploadToS3,uploadMultiple:uploadMultiple,setThumbnail:setThumbnail}}]),app.directive("navCollapse",function(){return{restrict:"A",link:function($scope,$el){var $dropdowns=$el.find("ul").parent("li"),$a=$dropdowns.children("a"),$notDropdowns=$el.children("li").not($dropdowns),$notDropdownsLinks=$notDropdowns.children("a"),app=angular.element(".appWrapper"),sidebar=angular.element("#sidebar"),controls=angular.element("#controls");$dropdowns.addClass("dropdown");var $submenus=$dropdowns.find("ul >.dropdown");$submenus.addClass("submenu"),$a.append('<i class="fa fa-plus"></i>'),$a.on("click",function(event){if(app.hasClass("sidebar-sm")||app.hasClass("sidebar-xs")||app.hasClass("hz-menu"))return!1;var $this=angular.element(this),$parent=$this.parent("li"),$openSubmenu=angular.element(".submenu.open");$parent.hasClass("submenu")||$dropdowns.not($parent).removeClass("open").find("ul").slideUp(),$openSubmenu.not($this.parents(".submenu")).removeClass("open").find("ul").slideUp(),
$parent.toggleClass("open").find(">ul").stop().slideToggle(),event.preventDefault()}),$dropdowns.on("mouseenter",function(){sidebar.addClass("dropdown-open"),controls.addClass("dropdown-open")}),$dropdowns.on("mouseleave",function(){sidebar.removeClass("dropdown-open"),controls.removeClass("dropdown-open")}),$notDropdownsLinks.on("click",function(){$dropdowns.removeClass("open").find("ul").slideUp()});var $activeDropdown=angular.element(".dropdown>ul>.active").parent();$activeDropdown.css("display","block")}}}),app.directive("ripple",function(){return{restrict:"A",link:function(scope,element){var parent,ink,d,x,y;angular.element(element).find(">li>a").click(function(e){parent=angular.element(this).parent(),0===parent.find(".ink").length&&parent.prepend('<span class="ink"></span>'),ink=parent.find(".ink"),ink.removeClass("animate"),ink.height()||ink.width()||(d=Math.max(parent.outerWidth(),parent.outerHeight()),ink.css({height:d,width:d})),x=e.pageX-parent.offset().left-ink.width()/2,y=e.pageY-parent.offset().top-ink.height()/2,ink.css({top:y+"px",left:x+"px"}).addClass("animate"),setTimeout(function(){angular.element(".ink").remove()},600)})}}}),app.directive("collapseSidebar",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,element){var app=angular.element(".appWrapper"),$window=angular.element(window),width=$window.width(),removeRipple=function(){angular.element("#sidebar").find(".ink").remove()},collapse=function(){width=$window.width(),992>width?app.addClass("sidebar-sm"):app.removeClass("sidebar-sm sidebar-xs"),768>width?app.removeClass("sidebar-sm").addClass("sidebar-xs"):width>992?app.removeClass("sidebar-sm sidebar-xs"):app.removeClass("sidebar-xs").addClass("sidebar-sm"),app.hasClass("sidebar-sm-forced")&&app.addClass("sidebar-sm"),app.hasClass("sidebar-xs-forced")&&app.addClass("sidebar-xs")};collapse(),$window.resize(function(){if(width!==$window.width()){var t;clearTimeout(t),t=setTimeout(collapse,300),removeRipple()}}),element.on("click",function(e){app.hasClass("sidebar-sm")?app.removeClass("sidebar-sm").addClass("sidebar-xs"):app.hasClass("sidebar-xs")?app.removeClass("sidebar-xs"):app.addClass("sidebar-sm"),app.removeClass("sidebar-sm-forced sidebar-xs-forced"),app.parent().removeClass("sidebar-sm sidebar-xs"),removeRipple(),e.preventDefault()})}}}]),app.directive("tileControlClose",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.addClass("closed").fadeOut()})}}}),app.directive("tileControlFullscreen",function(){return{restrict:"A",link:function(scope,element){var dropdown=element.parents(".dropdown");element.on("click",function(){dropdown.trigger("click")})}}}),app.directive("tileControlRefresh",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile"),dropdown=element.parents(".dropdown");element.on("click",function(){tile.addClass("refreshing"),dropdown.trigger("click")})}}}),app.directive("tileControlToggle",function(){return{restrict:"A",link:function(scope,element){var tile=element.parents(".tile");element.on("click",function(){tile.toggleClass("collapsed"),tile.children().not(".tile-header").slideToggle(150)})}}}),app.directive("slimscroll",function(){return{restrict:"A",link:function($scope,$el,$attr){var option={},refresh=function(){$attr.slimscroll?option=$scope.$eval($attr.slimscroll):$attr.slimscrollOption&&(option=$scope.$eval($attr.slimscrollOption)),$el.slimscroll({destroy:!0}),$el.slimscroll(option)};refresh();var collapseBtn=angular.element(".sidebar-collapse"),$window=angular.element(window),sidebar=angular.element("#sidebar"),checkScrollbar=function(){refresh(),angular.element("#sidebar .slimScrollBar").is(":visible")?sidebar.removeClass("scroll-inactive"):sidebar.addClass("scroll-inactive")};collapseBtn.on("click",function(){checkScrollbar()}),$window.resize(function(){checkScrollbar()}),$attr.slimscroll&&!option.noWatch&&$scope.$watchCollection($attr.slimscroll,refresh),$attr.slimscrollWatch&&$scope.$watchCollection($attr.slimscrollWatch,refresh),$attr.slimssrollListenTo&&$scope.on($attr.slimscrollListenTo,refresh)}}}),app.directive("countTo",["$timeout",function($timeout){return{replace:!1,scope:!0,link:function(scope,element,attrs){var num,refreshInterval,duration,steps,step,countTo,increment,e=element[0],calculate=function(){refreshInterval=30,step=0,scope.timoutId=null,countTo=parseInt(attrs.countTo)||0,scope.value=parseInt(attrs.value,10)||0,duration=1e3*parseFloat(attrs.duration)||0,steps=Math.ceil(duration/refreshInterval),increment=(countTo-scope.value)/steps,num=scope.value},tick=function(){scope.timoutId=$timeout(function(){num+=increment,step++,step>=steps?($timeout.cancel(scope.timoutId),num=countTo,e.textContent=countTo):(e.textContent=Math.round(num),tick())},refreshInterval)},start=function(){scope.timoutId&&$timeout.cancel(scope.timoutId),calculate(),tick()};return attrs.$observe("countTo",function(val){val&&start()}),attrs.$observe("value",function(val){start()}),!0}}}]),app.directive("gallery",function(){return{restrict:"A",link:function(scope,element,attrs){var defaults={},options=angular.extend({},defaults,scope.$eval(attrs.gallery));element.magnificPopup({delegate:options.selector,gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:"Error: Unable to Load Image",titleSrc:function(item){return item.el.attr("title")}},tLoading:"Loading...",mainClass:"mfp-img-mobile",type:"image"})}}});var angles=angular.module("angles",[]);angles.chart=function(type){return{restrict:"A",scope:{data:"=",options:"=",id:"@",width:"=",height:"=",resize:"=",chart:"@",segments:"@",responsive:"=",tooltip:"=",legend:"=",maintainAspectRatio:"="},link:function($scope,$elem){var ctx=$elem[0].getContext("2d"),autosize=!1;$scope.size=function(){$scope.width<=0||!$scope.width?($elem.width($elem.parent().width()),ctx.canvas.width=$elem.width()):(ctx.canvas.width=$scope.width||ctx.canvas.width,autosize=!0),$scope.height<=0||!$scope.height?($elem.height($elem.parent().height()),ctx.canvas.height=ctx.canvas.width/2):(ctx.canvas.height=$scope.height||ctx.canvas.height,autosize=!0)},$scope.$watch("data",function(newVal,oldVal){chartCreated&&chartCreated.destroy();var options=$scope.options||{};newVal&&($scope.chart&&(type=$scope.chart),autosize&&($scope.size(),chart=new Chart(ctx)),($scope.responsive||$scope.resize)&&(options.responsive=!0),void 0!==$scope.responsive&&(options.responsive=$scope.responsive),void 0!==$scope.maintainAspectRatio&&(options.maintainAspectRatio=$scope.maintainAspectRatio),chartCreated=chart[type]($scope.data,options),chartCreated.update(),$scope.legend&&(angular.element($elem[0]).parent().next().remove(),angular.element($elem[0]).parent().after(chartCreated.generateLegend())))},!0),$scope.$watch("tooltip",function(newVal,oldVal){if(chartCreated&&chartCreated.draw(),void 0!==newVal&&chartCreated.segments&&!(!isFinite(newVal)||newVal>=chartCreated.segments.length||0>newVal)){var activeSegment=chartCreated.segments[newVal];activeSegment.save(),activeSegment.fillColor=activeSegment.highlightColor,chartCreated.showTooltip([activeSegment]),activeSegment.restore()}},!0),$scope.size();var chartCreated,chart=new Chart(ctx)}}},angles.directive("chart",function(){return angles.chart()}),angles.directive("linechart",function(){return angles.chart("Line")}),angles.directive("barchart",function(){return angles.chart("Bar")}),angles.directive("radarchart",function(){return angles.chart("Radar")}),angles.directive("polarchart",function(){return angles.chart("PolarArea")}),angles.directive("piechart",function(){return angles.chart("Pie")}),angles.directive("doughnutchart",function(){return angles.chart("Doughnut")}),angles.directive("donutchart",function(){return angles.chart("Doughnut")});